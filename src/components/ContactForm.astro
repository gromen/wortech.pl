---
---

<form id="contact-form" class="space-y-6">
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
    <div>
      <label for="name" class="block text-sm font-medium mb-2">Imię i nazwisko *</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-3 rounded-lg bg-dark-surface border border-dark-border text-dark-text placeholder:text-dark-muted focus:outline-none focus:border-orange transition-colors light:bg-white light:border-gray-300 light:text-charcoal light:placeholder:text-gray-400 light:focus:border-orange"
        placeholder="Jan Kowalski"
      />
    </div>
    <div>
      <label for="email" class="block text-sm font-medium mb-2">Email *</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-3 rounded-lg bg-dark-surface border border-dark-border text-dark-text placeholder:text-dark-muted focus:outline-none focus:border-orange transition-colors light:bg-white light:border-gray-300 light:text-charcoal light:placeholder:text-gray-400 light:focus:border-orange"
        placeholder="jan@firma.pl"
      />
    </div>
  </div>

  <div>
    <label for="phone" class="block text-sm font-medium mb-2">Telefon</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      class="w-full px-4 py-3 rounded-lg bg-dark-surface border border-dark-border text-dark-text placeholder:text-dark-muted focus:outline-none focus:border-orange transition-colors light:bg-white light:border-gray-300 light:text-charcoal light:placeholder:text-gray-400 light:focus:border-orange"
      placeholder="+48 500 000 000"
    />
  </div>

  <div>
    <label for="message" class="block text-sm font-medium mb-2">Wiadomość *</label>
    <textarea
      id="message"
      name="message"
      required
      rows="5"
      class="w-full px-4 py-3 rounded-lg bg-dark-surface border border-dark-border text-dark-text placeholder:text-dark-muted focus:outline-none focus:border-orange transition-colors resize-none light:bg-white light:border-gray-300 light:text-charcoal light:placeholder:text-gray-400 light:focus:border-orange"
      placeholder="Treść wiadomości..."
    ></textarea>
  </div>

  <div id="form-status" class="hidden text-sm rounded-lg p-4"></div>

  <button
    type="submit"
    class="inline-flex items-center justify-center px-8 py-3 bg-orange text-white font-semibold rounded-lg hover:bg-orange-light transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
  >
    <span id="btn-text">Wyślij wiadomość</span>
    <svg id="btn-spinner" class="hidden w-5 h-5 ml-2 animate-spin" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
  </button>
</form>

<script is:inline>
  (function () {
    const form = document.getElementById('contact-form');
    if (!form || form.dataset.init) return;
    form.dataset.init = 'true';

    const status = document.getElementById('form-status');
    const btnText = document.getElementById('btn-text');
    const btnSpinner = document.getElementById('btn-spinner');
    const submitBtn = form.querySelector('button[type="submit"]');

    // Track when user starts filling out the form
    form.addEventListener('input', function () {
      if (!form.dataset.startTracked) {
        if (window.gtag) {
          window.gtag('event', 'contact_form_start', {
            form_name: 'contact',
          });
        }
        form.dataset.startTracked = 'true';
      }
    }, { once: true });

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        message: formData.get('message'),
      };

      btnText.textContent = 'Wysyłanie...';
      btnSpinner.classList.remove('hidden');
      submitBtn.disabled = true;

      fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      })
        .then(function (response) {
          if (!response.ok) {
            throw new Error('HTTP ' + response.status + ': ' + response.statusText);
          }
          return response;
        })
        .then(function (response) {
          // Track successful form submission in Google Analytics 4
          if (window.gtag) {
            window.gtag('event', 'generate_lead', {
              method: 'email',
              form_name: 'contact_form',
              value: 1,
            });
          }

          status.textContent = 'Wiadomość została wysłana. Skontaktujemy się wkrótce!';
          status.className = 'text-sm rounded-lg p-4 bg-green-500/10 text-green-400 light:bg-green-50 light:text-green-700';
          status.classList.remove('hidden');
          form.reset();
        })
        .catch(function (error) {
          console.error('[ContactForm] Submission error:', error);
          var isNetworkError = error instanceof TypeError;
          var errorMessage = isNetworkError
            ? 'Problem z połączeniem. Sprawdź swoją sieć i spróbuj ponownie.'
            : 'Wystąpił błąd. Spróbuj ponownie lub skontaktuj się telefonicznie.';
          status.textContent = errorMessage;
          status.className = 'text-sm rounded-lg p-4 bg-red-500/10 text-red-400 light:bg-red-50 light:text-red-700';
          status.classList.remove('hidden');
        })
        .finally(function () {
          btnText.textContent = 'Wyślij wiadomość';
          btnSpinner.classList.add('hidden');
          submitBtn.disabled = false;
        });
    });
  })();
</script>
